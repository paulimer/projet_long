library(Seurat)
library(ggplot2)
library(patchwork)
library(dplyr)
library(readr)
library(tidyr)
library(tibble)
library(stringr)
library(janitor)
library(tibble)

visium <- Load10X_Spatial("/home/paulet/data/sc_mousebrain_allen/st_mousebrain",
                          filename = "V1_Mouse_Brain_Sagittal_Anterior_Section_2_filtered_feature_bc_matrix.h5",
                          assay = "spatial",
                          slice = "V1_Mouse_Brain_Sagittal_Anterior_Section_2_image.tif")

cell2loc_ab <- read_csv("./cell2loc/results/cell2location_map/abundance_matrix.csv")
cell2loc_ab <- cell2loc_ab %>%
  column_to_rownames("sample_name")
colnames(cell2loc_ab) <- substring(colnames(cell2loc_ab), 24)

# rescaling for consistent plotting
cell2loc_per <- apply(cell2loc_ab, 1, rescale)


visium <- AddMetaData(visium, metadata = stereo_w)
sp_plot <- SpatialFeaturePlot(visium, features = colnames(stereo_w))
ggsave("./stereoscope/stereo.png")
